import{u as j}from"./diveLogService-Rctw_v7U.js";import{V as A}from"./VContainer-DS-n9MH9.js";import{a as f,V as p}from"./VRow-FatItoKp.js";import{j as I,r as v,L as F,B as m,l as e,n,i as t,q as i,s as c,t as s,M as x,v as M,A as r,k as w,x as $,F as q,y as k,D as E,H as h,J as H,K as J,N as K,V as O,O as P,z as R}from"./index-Bt62e36e.js";import{V as U}from"./VAlert-N9xfsE2Q.js";import{V as _}from"./VChip-BC01QLYy.js";import"./index-DW_MHI2K.js";const W={class:"d-flex"},G={class:"d-flex justify-space-between"},Q={class:"text-h6"},X={class:"mt-2 text-subtitle-2 text-medium-emphasis d-flex align-center"},Y={class:"mt-2"},Z={key:0,class:"mt-4 text-body-2 text-medium-emphasis text-truncate"},ee={class:"mt-2"},ue=I({__name:"DiveLog",setup(te){const{getDiveLogs:L,deleteDiveLog:z,loading:B,error:y}=j(),D=v([]),V=v(null),u=v(!1),d=v(null),N=o=>new Date(o).toLocaleDateString("zh-TW"),g=async()=>{try{D.value=await L()}catch(o){console.error(o)}},T=o=>{d.value=o,u.value=!0},b=()=>{u.value=!1,d.value=null},S=async()=>{if(d.value){V.value=d.value;try{await z(d.value),await g(),u.value=!1}catch(o){console.error(o)}finally{V.value=null,d.value=null}}};return F(()=>{g()}),(o,a)=>(n(),m(A,null,{default:e(()=>[t(p,{class:"mt-4"},{default:e(()=>[t(f,{cols:"12",class:"d-flex justify-space-between align-center"},{default:e(()=>[a[2]||(a[2]=i("h1",{class:"text-h4"},"我的潛水日誌",-1)),t(c,{color:"primary","prepend-icon":"mdi-plus",to:"/dive-log/new"},{default:e(()=>a[1]||(a[1]=[s(" 新增紀錄 ")])),_:1})]),_:1})]),_:1}),x(B)?(n(),m(p,{key:0},{default:e(()=>[t(f,{cols:"12",class:"text-center"},{default:e(()=>[t(M,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):x(y)?(n(),m(p,{key:1},{default:e(()=>[t(f,{cols:"12"},{default:e(()=>[t(U,{type:"error",variant:"tonal"},{default:e(()=>[s(r(x(y)),1)]),_:1})]),_:1})]),_:1})):(n(),m(p,{key:2},{default:e(()=>[(n(!0),w(q,null,$(D.value,l=>(n(),m(f,{key:l.id,cols:"12",md:"6"},{default:e(()=>[t(k,null,{default:e(()=>{var C;return[i("div",W,[t(O,{src:((C=l.images)==null?void 0:C[0])||"https://picsum.photos/500/300",class:"flex-grow-0",width:"200",height:"200",cover:""},null,8,["src"]),t(h,{class:"flex-grow-1"},{default:e(()=>[i("div",G,[i("h3",Q,r(l.name),1),t(_,{size:"small"},{default:e(()=>[s(r(N(l.date)),1)]),_:2},1024)]),i("div",X,[t(R,{icon:"mdi-map-marker",size:"small",class:"mr-1"}),s(" "+r(l.location),1)]),i("div",Y,[t(_,{size:"small",class:"mr-2"},{default:e(()=>[s(" 水溫 "+r(l.waterTemp)+"°C ",1)]),_:2},1024),t(_,{size:"small",class:"mr-2"},{default:e(()=>[s(" 深度 "+r(l.maxDepth)+"m ",1)]),_:2},1024),t(_,{size:"small"},{default:e(()=>[s(" 時間 "+r(l.duration)+"分鐘 ",1)]),_:2},1024)]),l.notes?(n(),w("p",Z,r(l.notes),1)):P("",!0),i("div",ee,[t(c,{variant:"text",color:"primary",size:"small",to:`/dive-log/${l.id}`},{default:e(()=>a[3]||(a[3]=[s(" 查看 ")])),_:2},1032,["to"]),t(c,{variant:"text",color:"error",size:"small",loading:V.value===l.id,onClick:ae=>T(l.id)},{default:e(()=>a[4]||(a[4]=[s(" 刪除 ")])),_:2},1032,["loading","onClick"])])]),_:2},1024)])]}),_:2},1024)]),_:2},1024))),128))]),_:1})),t(K,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value=l),width:"auto"},{default:e(()=>[t(k,null,{default:e(()=>[t(E,{class:"text-center"},{default:e(()=>a[5]||(a[5]=[s("確認刪除")])),_:1}),t(h,{class:"pt-4"},{default:e(()=>a[6]||(a[6]=[s(" 確定要刪除這筆潛水日誌嗎？此操作無法復原。 ")])),_:1}),t(H,null,{default:e(()=>[t(J),t(c,{color:"grey",variant:"text",onClick:b},{default:e(()=>a[7]||(a[7]=[s(" 取消 ")])),_:1}),t(c,{color:"error",onClick:S},{default:e(()=>a[8]||(a[8]=[s(" 確定刪除 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ue as default};
