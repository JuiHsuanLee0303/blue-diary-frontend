import{j as K,at as Q,as as X,r as n,e as A,L as Y,c as Z,Q as ee,B as P,l as r,n as f,i as a,q as o,O as I,G as ae,t as c,A as u,M as R,y as D,H as N,z as V,s as b,aw as se,k as T,x as te,F as le,I as re,J as oe,K as ie,N as ne,_ as ue}from"./index-CehNAOiO.js";import{V as de}from"./VContainer-D245ioWJ.js";import{a as ce,V as me}from"./VRow-Dj5EP_aS.js";import{V as O}from"./VAlert-r_Do5ysX.js";import{V as ve}from"./VForm-Cx2nzHkh.js";import{V as v}from"./VTextField-Bv30GIbp.js";import{b as B}from"./VSelect-6tFFsFbR.js";import"./VChip-WM5Ppmhe.js";const fe={class:"d-flex justify-center align-center mb-6"},pe={class:"text-subtitle-1 text-medium-emphasis"},Ve={class:"text-h3 mb-2"},be={class:"mb-6"},we={class:"d-flex justify-space-between align-center mb-4"},ye={class:"d-flex align-center"},xe={class:"d-flex justify-space-between align-center mb-2"},_e={class:"text-subtitle-1"},ge={class:"d-flex align-center mb-4"},Pe={class:"d-flex gap-4"},De={class:"d-flex align-center mb-2"},he={class:"text-h6"},Ce={class:"mb-0"},Se=K({__name:"Profile",setup(Ue){const i=Q(),z=X(),F=ee(),h=n(null),w=n(null),y=n(!1),j=["PADI","SSI","NAUI","TDI","其他"];A(()=>i.user?t.value.name!==i.user.name||t.value.currentPassword||t.value.newPassword||JSON.stringify(t.value.certificates)!==JSON.stringify(i.user.certificates||[]):!1);const t=n({name:"",email:"",certificates:[],currentPassword:"",newPassword:"",confirmPassword:""}),x=()=>{i.user&&(t.value={name:i.user.name,email:i.user.email,certificates:[...i.user.certificates||[]],currentPassword:"",newPassword:"",confirmPassword:""})},C=s=>!!s||"此欄位為必填",L=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s)||"請輸入有效的電子郵件",M=s=>s?/^https?:\/\/.+/.test(s)||"請輸入有效的URL連結":!0,W=[s=>!s||s.length>=6||"密碼長度至少需要6個字元"],E=s=>!t.value.newPassword||s===t.value.newPassword||"密碼不一致",J=()=>{t.value.certificates.push({system:"",level:"",url:""})},$=s=>{t.value.certificates.splice(s,1)},q=s=>{switch(s){case"PADI":return["Open Water Diver","Advanced Open Water Diver","Rescue Diver","Divemaster","Instructor"];case"SSI":return["Open Water Diver","Advanced Adventurer","Rescue Diver","Divemaster","Instructor"];case"NAUI":return["Scuba Diver","Advanced Scuba Diver","Rescue Diver","Divemaster","Instructor"];case"TDI":return["Open Water Diver","Advanced Nitrox Diver","Decompression Procedures","Extended Range","Instructor"];default:return[]}};Y(()=>{i.refreshUserData(),x()}),Z(()=>i.user,s=>{s?x():F.push("/login")});const p=n(!1),_=n("success"),S=n(""),U=n(""),k=(s,e)=>{_.value=s,S.value=s==="success"?"更新成功":"更新失敗",U.value=e,p.value=!0},G=async()=>{var e;const s=await((e=h.value)==null?void 0:e.validate());if(s!=null&&s.valid){y.value=!0,w.value=null;try{await z.updateProfile({name:t.value.name,email:t.value.email,certificates:t.value.certificates,currentPassword:t.value.currentPassword,newPassword:t.value.newPassword}),await i.refreshUserData(),x(),k("success","個人資料更新成功！")}catch(d){k("error",d)}finally{y.value=!1}}},H=A(()=>{var s;return(s=i.user)!=null&&s.name?i.user.name.charAt(0).toUpperCase():""});return(s,e)=>(f(),P(de,null,{default:r(()=>[a(me,null,{default:r(()=>[a(ce,{cols:"12"},{default:r(()=>{var d;return[o("div",fe,[a(ae,{color:"primary",size:"48",class:"mr-4"},{default:r(()=>[c(u(H.value),1)]),_:1}),o("div",null,[e[7]||(e[7]=o("h1",{class:"text-h4 mb-1"},"個人資料",-1)),o("div",pe,u((d=R(i).user)==null?void 0:d.email),1)])]),a(D,{class:"mb-6 mx-auto","max-width":"600",variant:"elevated"},{default:r(()=>[a(N,{class:"text-center"},{default:r(()=>{var l;return[a(V,{icon:"mdi-diving-scuba",color:"primary",size:"48",class:"mb-2"}),o("div",Ve,u(((l=R(i).user)==null?void 0:l.diveCount)||0),1),e[8]||(e[8]=o("div",{class:"text-subtitle-1 text-medium-emphasis"},"總潛水次數",-1))]}),_:1})]),_:1}),w.value?(f(),P(O,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-4"},{default:r(()=>[c(u(w.value),1)]),_:1})):I("",!0),a(D,{class:"pa-6 mx-auto","max-width":"600",variant:"elevated"},{default:r(()=>[a(ve,{ref_key:"form",ref:h},{default:r(()=>[a(v,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.name=l),label:"姓名",variant:"outlined",rules:[C],class:"mb-4"},null,8,["modelValue","rules"]),a(v,{modelValue:t.value.email,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.email=l),label:"電子郵件",type:"email",variant:"outlined",rules:[C,L],readonly:"",class:"mb-4"},null,8,["modelValue","rules"]),o("div",be,[o("div",we,[o("div",ye,[a(V,{icon:"mdi-certificate",class:"mr-2"}),e[9]||(e[9]=o("h3",{class:"text-h6"},"潛水證照",-1))]),a(b,{color:"primary",variant:"text",disabled:t.value.certificates.length>=5,onClick:J,"prepend-icon":"mdi-plus"},{default:r(()=>e[10]||(e[10]=[c(" 新增證照 ")])),_:1},8,["disabled"])]),a(se,{group:""},{default:r(()=>[(f(!0),T(le,null,te(t.value.certificates,(l,g)=>(f(),T("div",{key:g,class:"mb-4 pa-4 bg-grey-darken-4 rounded-lg elevation-1"},[o("div",xe,[o("span",_e,"證照 "+u(g+1),1),a(b,{icon:"mdi-delete",variant:"text",density:"comfortable",color:"error",onClick:m=>$(g)},null,8,["onClick"])]),a(B,{modelValue:l.system,"onUpdate:modelValue":m=>l.system=m,label:"證照系統",items:j,variant:"outlined",density:"comfortable",class:"mb-2","hide-details":""},null,8,["modelValue","onUpdate:modelValue"]),a(B,{modelValue:l.level,"onUpdate:modelValue":m=>l.level=m,label:"等級",items:q(l.system),variant:"outlined",density:"comfortable",class:"mb-2",disabled:!l.system,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","items","disabled"]),a(v,{modelValue:l.url,"onUpdate:modelValue":m=>l.url=m,label:"證照圖片連結",variant:"outlined",density:"comfortable",rules:[M],"hide-details":""},null,8,["modelValue","onUpdate:modelValue","rules"])]))),128))]),_:1}),t.value.certificates.length===0?(f(),P(O,{key:0,type:"info",variant:"tonal",icon:"mdi-information",class:"mt-2"},{default:r(()=>e[11]||(e[11]=[c(" 尚未新增任何證照 ")])),_:1})):I("",!0)]),a(re,{class:"mb-6"}),o("div",ge,[a(V,{icon:"mdi-lock",class:"mr-2"}),e[12]||(e[12]=o("h3",{class:"text-h6"},"修改密碼",-1))]),a(v,{modelValue:t.value.currentPassword,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.currentPassword=l),label:"目前密碼",type:"password",variant:"outlined",class:"mb-4"},null,8,["modelValue"]),a(v,{modelValue:t.value.newPassword,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.newPassword=l),label:"新密碼",type:"password",variant:"outlined",rules:W,class:"mb-4"},null,8,["modelValue"]),a(v,{modelValue:t.value.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.confirmPassword=l),label:"確認新密碼",type:"password",variant:"outlined",rules:[E],class:"mb-6"},null,8,["modelValue","rules"]),o("div",Pe,[a(b,{color:"primary",size:"large",loading:y.value,onClick:G,"prepend-icon":"mdi-check"},{default:r(()=>e[13]||(e[13]=[c(" 更新資料 ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]}),_:1})]),_:1}),a(ne,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=d=>p.value=d),width:"auto"},{default:r(()=>[a(D,null,{default:r(()=>[a(N,{class:"pa-4"},{default:r(()=>[o("div",De,[a(V,{color:_.value==="success"?"success":"error",size:"24",class:"mr-2"},{default:r(()=>[c(u(_.value==="success"?"mdi-check-circle":"mdi-alert-circle"),1)]),_:1},8,["color"]),o("span",he,u(S.value),1)]),o("p",Ce,u(U.value),1)]),_:1}),a(oe,null,{default:r(()=>[a(ie),a(b,{color:"primary",variant:"text",onClick:e[5]||(e[5]=d=>p.value=!1)},{default:r(()=>e[14]||(e[14]=[c(" 確定 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ze=ue(Se,[["__scopeId","data-v-5d505641"]]);export{ze as default};
